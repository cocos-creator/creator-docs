# 微信小游戏引擎插件使用说明

游戏引擎插件是微信 7.0.7 版本新增的一项功能。此插件内置了 Cocos Creator 引擎的官方版本，若玩家首次体验的游戏中启用了此插件，则所有同样启用此插件的游戏，都无需再次下载 Cocos Creator 引擎，只需直接使用公共插件库中的相同版本引擎，或者增量更新引擎即可。

也就是说，当一个玩家玩过了由 Cocos Creator v2.2.0 开发的 A 游戏，里面已启用了此插件。然后他又玩了同样是 v2.2.0 开发的 B 游戏，如果 B 游戏也启用了此插件，那么就无需重新下载 Cocos Creator 引擎。即使 B 游戏使用的是 v2.2.1 的 Cocos Creator，微信也只需要增量更新引擎两个版本的差异部分。这样就可以大幅减少小游戏的下载量，提升小游戏启动速度 0.5 ～ 2s，获得更好的用户体验。

## v2.0.5 ~ 2.2.0 的使用方法

1. 下载安装一个专用的 [微信引擎插件功能插件](https://github.com/knoxHuang/plugin-wechat-engine-separation)，该插件面向 Cocos Creator v2.0.5 ~ 2.2.0，用于帮助开发者在构建过程中自动生成微信小游戏引擎插件所需的文件结构与配置。

    **插件安装方法**：

    - 应用于全局（所有项目）：将解压后的插件文件夹拷贝到 `用户/.CocosCreator/packages`（Mac 系统）或者 `C:\Users\用户\.CocosCreator\packages`（Windows 系统） 下即可。
    - 应用于单个项目：将解压后的插件文件夹拷贝到与项目工程中与 assets 文件夹同级的 packages 文件夹下（如果没有可以自行创建一个）。

    **注意**：Cocos Creator v2.2.1 之后将会内置该功能到编辑器中，不需要再安装该插件。

2. 插件安装完成后，重启 Cocos Creator，在 **构建发布** 面板的 **发布平台** 中选择 **微信小游戏** 进行构建发布（该功能仅支持 **非调试** 模式）。即可在构建发布完成后自动进行适配，无需其他操作。之后如需禁用引擎插件功能，直接删除此插件即可。

## v2.2.1 之后的使用方法

使用 Cocos Creator 打开项目工程，在 **构建发布** 面板的 **发布平台** 中选择 **微信小游戏**，勾选 **允许分离引擎**。然后直接构建发布即可（该功能仅支持 **非调试** 模式）

![](./publish-wechatgame/build.png)

## FAQ

问：微信小游戏开放数据域支持该功能吗？
答：根据微信的规则，目前还不支持。

问：启用引擎插件后，是否仍然会把引擎代码算入首包包体中？
答：根据微信的规则，暂时仍然会计算在内，但是玩家加载游戏时会优先读取本地相同版本的引擎插件，从而减少下载量。

问：引擎插件功能是否支持自定义引擎？
答：不支持，构建时如果版本不匹配或者启用了自定义引擎，将会提示报错信息。

问：Cocos Creator v2.2.0 在 iOS 9 上启用引擎插件后无法进入游戏？
答：非常抱歉，这是已知的兼容性问题，在 v2.2.1 中已进行修复。

## 参考链接

- [微信小游戏引擎插件接入文档](https://developers.weixin.qq.com/minigame/dev/guide/base-ability/game-engine-plugin.html)
